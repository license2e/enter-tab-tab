(function(e){var g={init:function(){return this.each(function(){var a=e(this);a.unbind("change");a.find("[contenteditable]").each(function(){e(this).contentEditable("field",a)})})},getCaretCharacterOffsetWithin:function(a){var d=0;if("undefined"!=typeof window.getSelection){var d=window.getSelection().getRangeAt(0),b=d.cloneRange();b.selectNodeContents(a);b.setEnd(d.endContainer,d.endOffset);d=b.toString().length}else"undefined"!=typeof document.selection&&"Control"!=document.selection.type&&(d=document.selection.createRange(),
b=document.body.createTextRange(),b.moveToElementText(a),b.setEndPoint("EndToEnd",d),d=b.text.length);return d},field:function(a,d){return this.each(function(){var b=e(this),g=b.attr("data-key");b.on("focus",function(){var a=e(this);a.data("enter",a.html());a.data("before",a.html());return a}).on("keyup paste",function(b){var c=e(this),f=c.html(),j=d.getCaretCharacterOffsetWithin(c[0]);b=b.keyCode;if(c.data("before")!==f){c.data("before",f);var h={};h[g]=f;a.trigger({type:"change",action:"update",
changed:h,keyCode:b,carret:j,$this:c})}return c}).on("blur",function(b){var c=e(this),f=c.html(),j=d.getCaretCharacterOffsetWithin(c[0]);b=b.keyCode;if(c.data("enter")!==f){c.data("enter",f);var h={};h[g]=f;a.trigger({type:"change",action:"save",changed:h,keyCode:b,carret:j,$this:c})}return c})})}};e.fn.contentEditable=function(a){if(g[a])return new_args=Array.prototype.slice.call(arguments,1),new_args[new_args.length]=g,g[a].apply(this,new_args);if("object"===typeof a||!a)return g.init.apply(this,
arguments);e.error("Method "+a+" does not exist on jQuery.contentEditable")}})(jQuery);